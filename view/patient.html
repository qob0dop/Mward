<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>患者信息</title>
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">-->
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        .layui-btn:not(.layui-btn-lg ):not(.layui-btn-sm):not(.layui-btn-xs) {
            height: 34px;
            line-height: 34px;
            padding: 0 8px;
        }
        
        .layui-input {
            color: dodgerblue;
        }

        .layui-btn-radius {
            width: 80px;
        }

        body {
            background-color: transparent;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        .layui-elem-quote {
            padding: 5px 15px;
            margin: 0;
            font-weight: bold;
            font-size: 1.1rem;
            border: none;
            background: #fff;
        }
        .layui-layer-setwin a {
            height: 26px;
            transform: scale(1.5);
        }
        
        /* 页面布局样式 */
        .main-content {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .layuimini-container {
            padding: 0;
            margin: 0;
            border: none;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .layuimini-main {
            padding: 0;
            margin: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* 底部选项卡样式 */
        .bottom-tabs {
            position: relative;  /* 改为相对定位 */
            background: #fff;
            border-top: 2px solid #e6e6e6;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            height: 60px;
            margin: 0;
            padding: 0;
        }
        
        .bottom-tabs .layui-tab-title {
            margin: 0;
            background: #fff;
            border: none;
            display: flex;
            justify-content: center;
            height: 100%;
            align-items: center;
        }
        
        .bottom-tabs .layui-tab-title li {
            position: relative;
            background: transparent;
            border: none;
            margin: 0 8px;
            padding: 12px 20px;
            transition: all 0.3s ease;
            border-radius: 0;
            flex: none;
            height: auto;
            line-height: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .bottom-tabs .layui-tab-title li:hover {
            background: #e8f4fd;
            color: #1e9fff;
            border-radius: 6px;
        }
        
        .bottom-tabs .layui-tab-title li.layui-this {
            background: linear-gradient(135deg, #1e9fff 0%, #1890ff 100%);
            color: #fff;
            font-weight: bold;
            box-shadow: 0 -2px 8px rgba(30, 159, 255, 0.3);
            border-radius: 8px;
        }
        
        /* 选项卡内容区域 */
        .tab-content-area {
            flex: 1;
            overflow-y: auto;
            margin: 0;
            position: relative;
            background: #fff;
        }

        .layui-tab-content {
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .layui-tab-item {
            height: 100%;
            padding: 0;
            margin: 0;
        }

        /* iframe容器样式 */
        .tab-iframe-container {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* 确保iframe填满容器 */
        .tab-content-area iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* 患者信息表单样式 */
        .layui-form {
            margin: 0;
            padding: 10px 15px;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="layuimini-container">
        <div class="layuimini-main main-content">
            <blockquote class="layui-elem-quote">
                <span id="patient-header-info">患者详细信息</span>
                <!--<button class="layui-btn layui-btn-sm" onclick="javascrript:location.reload()" style="float: right;">刷新</button>-->
                <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" onclick="javascrript:window.history.back()" style="float: right; font-size: 14px; margin-right: 20px; font-weight: normal;"><i class="layui-icon"></i>返回</button>
                <!--<button class="layui-btn layui-btn-normal" id="btn-fold">全部折叠</button>
                <button type="button" class="layui-btn layui-btn-primary" id="test-page-title">剔除默认标题栏</button>-->
                <br>
            </blockquote>

            <!-- 选项卡内容显示区域 -->
            <div class="tab-content-area">
                <div class="layui-tab-content">
                    <!-- 患者信息选项卡 -->
                    <div class="layui-tab-item layui-show" id="tab-patient">
                        <form class="layui-form layui-form-pane" action="">
                            <div class="layui-form-item">
                                <label class="layui-form-label">患者姓名</label>
                                <div class="layui-input-inline">
                                    <!--<div class="layui-input-block">-->
                                    <input type="text" name="pname" autocomplete="off" placeholder="" class="layui-input">
                                </div>
                                <label class="layui-form-label">次数</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="admiss_times" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>

                                <div class="layui-input-inline"> 
                                    <button type="button" name="tiwendan" class="layui-btn layui-btn-warm layui-btn-radius layui-anim" data-anim="layui-anim-fadein"> 体温单 </button>
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-radius layui-anim" data-anim="layui-anim-fadein">基本信息</button>
                                </div>
                            </div>
                            <div class="layui-form-item">

                                <label class="layui-form-label">入院日期</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="admiss_date" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">入院天数</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="admiss_days" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>

                                <div class="layui-input-inline">
                                    <button type="button" name="dianzibingli" class="layui-btn layui-btn-normal layui-btn-radius" onclick="javascrript:location.href = 'edoclist.html?ticks='+(new Date()).getTime()">电子病历</button>
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-radius">护理文书</button>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">性别</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="sex_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">年龄</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="ages" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-input-inline">
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-radius" onclick="javascrript:location.href = 'jylist.html?ticks='+(new Date()).getTime()">化验报告</button>
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-radius" onclick="javascrript:location.href = 'jclist.html?ticks='+(new Date()).getTime()">检查报告</button>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">住院号</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="inpatient_no" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">床号</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="bed_no" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-input-inline">
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-radius" onclick="javascrript:location.href = 'oplist.html'">手术信息</button>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">管床医生</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="refer_physician_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">管床护士</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="refer_nurse_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">诊断代码</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="admiss_diag" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">诊断名称</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="admiss_diag_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">护理级别</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="nursing" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                                <label class="layui-form-label">身份</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="responce_type_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- 医嘱选项卡 -->
                    <div class="layui-tab-item" id="tab-yizhu">
                        <div id="yizhu-content" class="tab-iframe-container">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 40px;"></i>
                                <div style="margin-top: 20px; font-size: 16px;">正在加载医嘱信息...</div>
                            </div>
                        </div>
                    </div>
                    <!-- 检验选项卡 -->
                    <div class="layui-tab-item" id="tab-jianyan">
                        <div id="jianyan-content" class="tab-iframe-container">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 40px;"></i>
                                <div style="margin-top: 20px; font-size: 16px;">正在加载检验信息...</div>
                            </div>
                        </div>
                    </div>
                    <!-- 检查选项卡 -->
                    <div class="layui-tab-item" id="tab-jiancha">
                        <div id="jiancha-content" class="tab-iframe-container">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 40px;"></i>
                                <div style="margin-top: 20px; font-size: 16px;">正在加载检查信息...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 底部选项卡 -->
            <div class="bottom-tabs">
                <div class="layui-tab" lay-filter="patientTab">
                    <ul class="layui-tab-title">
                        <li class="layui-this" data-index="0">患者信息</li>
                        <li data-index="1">医嘱</li>
                        <li data-index="2">检验</li>
                        <li data-index="3">检查</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script>layui.use(['table', 'treetable','appconfig','element'], function () {
                    var $ = layui.jquery;
                    var table = layui.table;
                    var treetable = layui.treetable;
                    var appconfig = layui.appconfig;
                    var element = layui.element;
            var userData = localStorage.getItem('userData');

            if (userData  === null) {
                layer.msg("请先选择患者！");
                return;
            } else {
                //layer.msg('加载中', {
                //    icon: 16
                //    , shade: 0.01
                //});
                var jsonData = JSON.parse(userData);
                console.log(jsonData);
                
                // 更新顶部患者信息显示
                $('#patient-header-info').html('<i class="layui-icon layui-icon-username" style="font-size: 18px; margin-right: 8px;"></i>' + 
                    jsonData.name + ' &nbsp;|&nbsp; ' + 
                    jsonData.inpatient_no + ' &nbsp;|&nbsp; ' + 
                    jsonData.sex_name + ' &nbsp;|&nbsp; ' + 
                    jsonData.ages + ' &nbsp;|&nbsp; ' + 
                    jsonData.bed_no + '床');
                
                $("input[name='pname']").val(jsonData.name);
                $("input[name='admiss_times']").val(jsonData.admiss_times);
                $("input[name='admiss_date']").val(jsonData.admiss_date_text2);
                $("input[name='admiss_days']").val(jsonData.admiss_days);
                $("input[name='sex_name']").val(jsonData.sex_name);
                $("input[name='ages']").val(jsonData.ages);
                $("input[name='inpatient_no']").val(jsonData.inpatient_no);
                $("input[name='bed_no']").val(jsonData.bed_no);
                $("input[name='refer_physician_name']").val(jsonData.refer_physician_name);
                $("input[name='refer_nurse_name']").val(jsonData.refer_nurse_name);
                $("input[name='admiss_diag']").val(jsonData.admiss_diag);
                $("input[name='admiss_diag_name']").val(jsonData.admiss_diag_name);
                $("input[name='nursing']").val(jsonData.nursing);
                $("input[name='responce_type_name']").val(jsonData.responce_type_name);


                var _twdurl = appconfig.twd_webpage + '/?patient_id=' + jsonData.patient_id + '&admiss_times=' + jsonData.admiss_times + '&api_host='+appconfig.api+"/";
                //var _dzblurl = appconfig.twd_webpage + "/test.pdf";
                var _dzblurl =  "/lib/pdfjs/test1.pdf";
                //体温单点击
                $("button[name='tiwendan']").click(function(){
                const now = new Date();
                const ticks = now.getTime();
                //console.log(ticks);
                    window.parent.layui.layer.open({
                        type: 2,
                        area: ['100%', '100%'],
                        title: "体温单" + " - " +jsonData.name + " - " +jsonData.inpatient_no + " - " +jsonData.sex_name+ " - " +jsonData.ages,
                        closeBtn: 1,
                        shadeClose: true, // 点击遮罩关闭层
                        content: _twdurl +"&ticks="+ticks //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                    });
                });
                //电子病历点击
    //            $("button[name='dianzibingli']").click(function(){
    //            const now = new Date();
    //            const ticks = now.getTime();
    ////_dzblurl = _dzblurl+"?ticks="+ticks
    ////alert(_dzblurl);
    //            //console.log(ticks);
    //                window.parent.layui.layer.open({
    //                    type: 1,
    //                    area: ['100%', '100%'],
    //                    title: "电子病历" + " - " +jsonData.name + " - " +jsonData.inpatient_no + " - " +jsonData.sex_name+ " - " +jsonData.ages,
    //                    closeBtn: 1,
    //                    shadeClose: true, // 点击遮罩关闭层
    //                    content:  "<iframe src='../../lib/pdf6/web/viewer.html?file=" +
    //                    //content:  "<iframe src='../../lib/pdf5/pdf.html?file=" +
    //            _dzblurl +
    //            "' style='width:100%;height:100%'></iframe>"//+"?ticks="+ticks //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
    //                });
    //            });


                $(".layuimini-container").show();
            }

            // 底部选项卡切换事件
            $('.bottom-tabs .layui-tab-title li').click(function(){
                var index = $(this).data('index');
                
                // 切换选项卡样式
                $('.bottom-tabs .layui-tab-title li').removeClass('layui-this');
                $(this).addClass('layui-this');
                
                // 切换内容显示
                $('.tab-content-area .layui-tab-item').removeClass('layui-show');
                
                var jsonData = JSON.parse(localStorage.getItem('userData'));
                var patientParams = '?patient_id=' + jsonData.patient_id + '&admiss_times=' + jsonData.admiss_times + '&ticks=' + (new Date()).getTime();
                
                // 根据选项卡切换加载不同内容
                switch(index) {
                    case 0: // 患者信息
                        $('#tab-patient').addClass('layui-show');
                        break;
                    case 1: // 医嘱
                        $('#tab-yizhu').addClass('layui-show');
                        if($('#yizhu-content iframe').length === 0) {
                            $('#yizhu-content').html('<iframe src="yizhu.html' + patientParams + '"></iframe>');
                        }
                        break;
                    case 2: // 检验
                        $('#tab-jianyan').addClass('layui-show');
                        if($('#jianyan-content iframe').length === 0) {
                            $('#jianyan-content').html('<iframe src="jy_apply.html' + patientParams + '"></iframe>');
                        }
                        break;
                    case 3: // 检查
                        $('#tab-jiancha').addClass('layui-show');
                        if($('#jiancha-content iframe').length === 0) {
                            $('#jiancha-content').html('<iframe src="jc_apply.html' + patientParams + '"></iframe>');
                        }
                        break;
                }
            });
        });</script>
</body>
</html>